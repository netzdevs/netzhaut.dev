@htmlonly

<pre>
From e9f428c29696179c89bfd504c0588cf178215c6a Mon Sep 17 00:00:00 2001
From: Dajo Frey &ltdajofrey+github@gmail.com>
Date: Sat, 26 Mar 2022 23:26:19 +0100
Subject: [PATCH] Improve autodoc script.

---
 CHANGES.txt                  | 10 ++--------
 build/.nhmake/options.nhmake | 16 ++++++++++++++--
 2 files changed, 16 insertions(+), 10 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index c40ec4a..3b67d82 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -1,13 +1,7 @@
 changes{
-  summary: "Improve build procedures."
+  summary: "Improve autodoc script."
   workload {
-      scope: "minor"
+      scope: "patch"
       author {name: "Dajo Frey"}
   }
-  workload {
-    lib: "nhmake", "netzhaut"
-    bin: "nhmake"
-    scope: "patch"
-    author {name: "Dajo Frey"}
-  }
 }
diff --git a/build/.nhmake/options.nhmake b/build/.nhmake/options.nhmake
index a7f6de5..435c2cc 100644
--- a/build/.nhmake/options.nhmake
+++ b/build/.nhmake/options.nhmake
@@ -205,12 +205,14 @@
 
 --autodoc 
 {
+    // Update netzhaut.
     chdir()
     updateHistory("CHANGES.txt")
     updateVersions()
+    system("cp CHANGES.txt /tmp/CHANGES.txt")
     system("rm CHANGES.txt")
-    system("git add .")
-    system("git commit -m \"[autodoc] Clean. Update history. Update versions.\"")
+
+    // Update docs.
     createPatch(
         "HEAD", 
         "external/netzhaut.dev/docs/patches/raw"
@@ -233,10 +235,20 @@
     createChangelogs(
         "external/netzhaut.dev/docs/changelogs/pages"
     )
+
+    // Generate docs.
     chdir("external/netzhaut.dev/docs")
     system("./doxygen.sh")
+
     // Remove patch pages because otherwise github-pages checks will fail.
     system("rm docs/patches/pages/*")
+
+    // Commit netzhaut changes.
+    chdir()
+    system("git add .")
+    system("git commit -m \"[autodoc] Clean. Update history. Update versions.\"")
+
+    // Commit docs changes.
     chdir("external/netzhaut.dev")
     system("git add .")
     system("git commit -m \"[autodoc] Generate patch data. Update HTML pages.\"")
-- 
2.34.1


</pre>
@endhtmlonly