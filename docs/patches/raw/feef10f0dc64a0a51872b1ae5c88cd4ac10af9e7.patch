From feef10f0dc64a0a51872b1ae5c88cd4ac10af9e7 Mon Sep 17 00:00:00 2001
From: Dajo Frey <dajofrey+github@gmail.com>
Date: Sun, 27 Mar 2022 00:57:04 +0100
Subject: [PATCH] Fix autodoc script.

---
 CHANGES.txt                  |  7 +++
 build/.nhmake/options.nhmake | 88 ++++++++++++++++++------------------
 2 files changed, 51 insertions(+), 44 deletions(-)
 create mode 100644 CHANGES.txt

diff --git a/CHANGES.txt b/CHANGES.txt
new file mode 100644
index 0000000..1aefe41
--- /dev/null
+++ b/CHANGES.txt
@@ -0,0 +1,7 @@
+changes{
+  summary: "Fix autodoc script."
+  workload {
+      scope: "patch"
+      author {name: "Dajo Frey"}
+  }
+}
diff --git a/build/.nhmake/options.nhmake b/build/.nhmake/options.nhmake
index fe5a93f..435c2cc 100644
--- a/build/.nhmake/options.nhmake
+++ b/build/.nhmake/options.nhmake
@@ -205,53 +205,53 @@
 
 --autodoc 
 {
-//    // Update netzhaut.
-//    chdir()
-//    updateHistory("CHANGES.txt")
-//    updateVersions()
-//    system("cp CHANGES.txt /tmp/CHANGES.txt")
-//    system("rm CHANGES.txt")
-//
-//    // Update docs.
-//    createPatch(
-//        "HEAD", 
-//        "external/netzhaut.dev/docs/patches/raw"
-//    ) 
-//    createPatchPages(
-//        "external/netzhaut.dev/docs/patches/raw",
-//        "external/netzhaut.dev/docs/patches/pages"
-//    )
-//    updateHeaders(
-//        "external/netzhaut.dev/docs/index.html",
-//        "external/netzhaut.dev/docs/theme/header_api.html",
-//        "external/netzhaut.dev/docs/theme/header_architecture.html",
-//        "external/netzhaut.dev/docs/theme/header_changelogs.html",
-//        "external/netzhaut.dev/docs/theme/header_design.html",
-//        "external/netzhaut.dev/docs/theme/header_general.html",
-//        "external/netzhaut.dev/docs/theme/header_guides.html",
-//        "external/netzhaut.dev/docs/theme/header_internals.html",
-//        "external/netzhaut.dev/docs/theme/header_patches.html"
-//    )
+    // Update netzhaut.
+    chdir()
+    updateHistory("CHANGES.txt")
+    updateVersions()
+    system("cp CHANGES.txt /tmp/CHANGES.txt")
+    system("rm CHANGES.txt")
+
+    // Update docs.
+    createPatch(
+        "HEAD", 
+        "external/netzhaut.dev/docs/patches/raw"
+    ) 
+    createPatchPages(
+        "external/netzhaut.dev/docs/patches/raw",
+        "external/netzhaut.dev/docs/patches/pages"
+    )
+    updateHeaders(
+        "external/netzhaut.dev/docs/index.html",
+        "external/netzhaut.dev/docs/theme/header_api.html",
+        "external/netzhaut.dev/docs/theme/header_architecture.html",
+        "external/netzhaut.dev/docs/theme/header_changelogs.html",
+        "external/netzhaut.dev/docs/theme/header_design.html",
+        "external/netzhaut.dev/docs/theme/header_general.html",
+        "external/netzhaut.dev/docs/theme/header_guides.html",
+        "external/netzhaut.dev/docs/theme/header_internals.html",
+        "external/netzhaut.dev/docs/theme/header_patches.html"
+    )
     createChangelogs(
         "external/netzhaut.dev/docs/changelogs/pages"
     )
-//
-//    // Generate docs.
-//    chdir("external/netzhaut.dev/docs")
-//    system("./doxygen.sh")
-//
-//    // Remove patch pages because otherwise github-pages checks will fail.
-//    system("rm docs/patches/pages/*")
-//
-//    // Commit netzhaut changes.
-//    chdir()
-//    system("git add .")
-//    system("git commit -m \"[autodoc] Clean. Update history. Update versions.\"")
-//
-//    // Commit docs changes.
-//    chdir("external/netzhaut.dev")
-//    system("git add .")
-//    system("git commit -m \"[autodoc] Generate patch data. Update HTML pages.\"")
+
+    // Generate docs.
+    chdir("external/netzhaut.dev/docs")
+    system("./doxygen.sh")
+
+    // Remove patch pages because otherwise github-pages checks will fail.
+    system("rm docs/patches/pages/*")
+
+    // Commit netzhaut changes.
+    chdir()
+    system("git add .")
+    system("git commit -m \"[autodoc] Clean. Update history. Update versions.\"")
+
+    // Commit docs changes.
+    chdir("external/netzhaut.dev")
+    system("git add .")
+    system("git commit -m \"[autodoc] Generate patch data. Update HTML pages.\"")
 }
 
 // SHOW ============================================================================================
-- 
2.34.1

